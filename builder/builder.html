<!doctype>
<html> 
<head>
    <title>jsPDF Builder</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" type="text/css" href="../examples/css/smoothness/jquery-ui-1.8.17.custom.css">
    <link rel="stylesheet" type="text/css" href="../examples/css/main.css">

    <script type="text/javascript" src="../examples/js/jquery/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="../examples/js/jquery/jquery-ui-1.8.17.custom.min.js"></script>
    <script type="text/javascript" src="configuration.js"></script>

    <script>
        $(document).ready(function() {
			var form = $('#selection');
			var html = '';
			var keys = Object.keys(configuration).reverse();
			var name = '';
			for (var i = 0; i < keys.length; i++) {
				name = keys[i];
				html = '<div>';
				html += '<input type="checkbox" name="' + name + '" value="' + name +'" />' + configuration[name].name
				html += '</div>';
				form.prepend(html);
			}
			
			$("#selection :checkbox").change(function() {
				var name = this.value;
				var deps = configuration[name].deps;
				if(this.checked === true) {
					for (var i = 0; i < deps.length; i++) {
						$('input[name="'+deps[i]+'"]').prop('checked', true).change();
					}
				}
				if(this.checked === false) {
					for (var i = 0; i < keys.length; i++) {
						if (configuration[keys[i]].deps.indexOf(name) !== -1) {
							$('input[name="'+keys[i]+'"]').prop('checked', false).change();
						}
					}
				}
			});
			form.submit(function( event ) {
			  build ( form.serializeArray() );
			  event.preventDefault();
			});
        });
		
		function loadBinaryResource (url, unicodeCleanUp) {
		  var req = new XMLHttpRequest()
		  req.open('GET', url, false)
		   // XHR binary charset opt by Marcus Granado 2006 [http://mgran.blogspot.com]
		  req.overrideMimeType('text\/plain; charset=x-user-defined');
		  req.send(null)
		  if (req.status !== 200) {
			throw new Error('Unable to load file');
		  }

		  var responseText = req.responseText;
		  var responseTextLen = req.responseText.length;
		  var StringFromCharCode = String.fromCharCode;
		  if (unicodeCleanUp === true) {    
			var i = 0;
			for (i = 0; i < responseText.length; i += 1) {
			  byteArray.push(StringFromCharCode(responseText.charCodeAt(i) & 0xff))
			}
			return byteArray.join("");
		  }
		  return req.responseText;
		}

		function uniq(a) {
			var prims = {"boolean":{}, "number":{}, "string":{}}, objs = [];

			return a.filter(function(item) {
				var type = typeof item;
				if(type in prims)
					return prims[type].hasOwnProperty(item) ? false : (prims[type][item] = true);
				else
					return objs.indexOf(item) >= 0 ? false : objs.push(item);
			});
		}
		
		function generateFileList(formValues) {
			var fileList = [];
			for (var i = 0; i < formValues.length; i++) {
				fileList.push(formValues[i].name + '.js');
				for (var j = 0; j < configuration[formValues[i].name].deps.length; j++) {
					fileList.push(configuration[formValues[i].name].deps[j] + '.js');
				}
			}
			fileList = uniq(fileList);
			return fileList;
		}
		
		function download(filename, text) {
		  var element = document.createElement('a');
		  element.setAttribute('href', 'data:text/javascript;charset=utf-8,' + encodeURIComponent(text));
		  element.setAttribute('download', filename);

		  element.style.display = 'none';
		  document.body.appendChild(element);

		  element.click();

		  document.body.removeChild(element);
		}
		
		function build(formValues) {
			var fileList = generateFileList(formValues);
			var loadedFiles = [];
			var result = '';
			
			for (var i = 0; i < fileList.length; i++) {
				loadedFiles.push(loadBinaryResource('../' + fileList[i]));
			}
			
			result = loadedFiles.join("\n\r");
			download('jsPDF.custom.js', result);
		}
    </script>
</head>

<body>

<a href="https://github.com/MrRio/jsPDF">
  <img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" />
</a>

<h1>jsPDF Builder (alpha)</h1>

<p>Build your own jsPDF-package</p>

<form id="selection" class="ui-tabs ui-widget ui-widget-content ui-corner-all">

<input type="submit" value="Build">
</form>

</body>
</html>
